[% 
SET state_pretty = {
    'confirmed' = loc('Open')
    'investigating' = loc('Investigating')
    'action scheduled' = loc('Action Scheduled')
    'fixed - council' = loc('Fixed')
    'not responsible' = loc('Not Responsible')
    'duplicate' = loc('Duplicate')
    'unable to fix' = loc('No further action')
};

SET state_groups = [
    [ loc('New'), [ 'confirmed', 'investigating' ] ],
    [ loc('Scheduled'), [ 'action scheduled' ] ],
    [ loc('Fixed'), [ 'fixed - council' ] ],
    [ loc('Closed'), [ 'not responsible', 'duplicate', 'unable to fix' ] ]
];

%]
[% DEFAULT current_state = problem.state %]
<select class="form-control" name="state"  id="state">
[% IF include_empty %]
    <option value="">---</option>
[% END %]
[% FOREACH group IN state_groups %]
    <optgroup label="[% group.0 %]">
    [% FOREACH state IN group.1 %]
        <option [% 'selected ' IF state == current_state %] value="[% state %]">[% state_pretty.$state %]</option>
    [% END %]
    </optgroup>
[% END %]
</select>
